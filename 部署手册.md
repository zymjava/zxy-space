# zxy 站点部署手册

个人简历站：**zxy.vvlab.xyz**，运行在阿里云 139.224.31.98（K3s + Nginx Ingress），镜像来自阿里云 ACR 上海个人版 **zxy-repo**。

---

## 一、迭代新版本（日常更新）

每次改完简历内容或样式、需要线上更新时，按下面顺序做即可。

### 1. 本地修改内容

- **文案**：编辑 `data/content.json`（基本信息、求职意向、教育/工作/项目经历等）。
- **照片**：把新图片放到 `assets/photos/`，在 `data/photos.json` 里维护路径，在 `content.json` 里引用对应 key。
- **样式/逻辑**：改 `css/`、`js/`、`index.html` 等。

### 2. 提交并推送到 GitHub

```bash
cd c:\Users\admin\vvlab\zxy
git add .
git commit -m "描述本次修改"
git push origin main
```

（如你用的是 `master` 分支，把 `main` 改成 `master`。）

### 3. 触发镜像构建（阿里云 ACR）

- **方式 A**：已配置「代码变更自动构建」时，push 后会自动构建，无需操作。
- **方式 B**：在 [阿里云 ACR 控制台](https://cr.console.aliyun.com/) → 个人版 → 镜像仓库 **zxy-repo** → **构建** → **立即构建**。

构建完成后会生成新镜像。线上**固定用 `latest`**，因此需保证 ACR 里该镜像有 `latest` 标签：若构建规则只打了版本号（如 `zxy-2026`），在 ACR 构建规则里勾选「同时打 latest」，或构建完成后在控制台给该镜像再打一个 `latest` 标签。

### 4. 让线上使用新镜像（在服务器 139.224.31.98 上执行）

在服务器上重启 Deployment，让 K3s 重新拉取 `latest`：

```bash
kubectl rollout restart deployment/zxy-site -n demo
kubectl rollout status deployment/zxy-site -n demo
```

### 5. 验证

浏览器打开 **http://zxy.vvlab.xyz**，确认内容/样式已是新版本。

---

## 二、首次部署 / 重新部署（参考）

- 镜像地址：`crpi-c87ddoa33spg7s3f.cn-shanghai.personal.cr.aliyuncs.com/zzlab_imagespace/zxy-repo:latest`（线上固定用 `latest`）。
- 部署文件在 **vvlab-deploy** 仓库：`deploy/vvlab-sites-zxy-only.yaml`。
- 服务器上 Nginx 已透传 Host，Ingress 已按 `zxy.vvlab.xyz` 指向 zxy-site。
- ACR 拉取密钥已在 `demo` 命名空间创建（`acr-secret`），若换密码需在服务器上重新 `kubectl create secret docker-registry ...`。

详细架构与 Nginx/Ingress 配置见 **vvlab-deploy** 仓库下的 `OPERATIONS.md`、`DEPLOY-SITES.md`。

---

## 三、小结：下次迭代要做的步骤

| 步骤 | 操作 |
|------|------|
| 1 | 本地改 `data/content.json`、照片、样式等 |
| 2 | `git add` → `git commit` → `git push`（zxy-space 仓库） |
| 3 | ACR 自动构建或控制台「立即构建」 |
| 4 | 服务器上执行：`kubectl rollout restart deployment/zxy-site -n demo` |
| 5 | 浏览器访问 http://zxy.vvlab.xyz 核对 |
